$if(title)$
<title>$title$</title>
$else$
<title>MDView</title>
$endif$
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown.min.css">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$$', '$$'], ['\\(', '\\)']],
      displayMath: [['$$$$', '$$$$'], ['\\[', '\\]']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<style>
  body {
    padding: 2rem;
    max-width: 900px;
    margin: auto;
    background: white;
    color: black;
    transition: background 0.3s ease, color 0.3s ease;
  }

  /* Dark mode styles */
  body.mdview-dark {
    background: #0b1020;
    color: #cbd5e1;
  }

  body.mdview-dark .markdown-body {
    filter: invert(1) hue-rotate(180deg);
  }

  img {
    max-width: 100%;
    height: auto;
    cursor: zoom-in;
    transition: transform 0.2s ease;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  img.zoomed {
    transform: scale(2);
    cursor: zoom-out;
  }

  /* Better support for special characters and Unicode */
  .markdown-body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    line-height: 1.6;
  }

  /* Ensure proper rendering of mathematical expressions */
  .MathJax {
    font-size: 1.1em;
  }

  /* Better table styling */
  table {
    border-collapse: collapse;
    margin: 1rem 0;
  }

  th, td {
    border: 1px solid #ddd;
    padding: 8px 12px;
    text-align: left;
  }

  th {
    background-color: #f6f8fa;
    font-weight: 600;
  }

  /* Code block improvements */
  pre {
    background-color: #f6f8fa;
    border-radius: 6px;
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
  }

  code {
    background-color: rgba(175, 184, 193, 0.2);
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-size: 85%;
  }

  /* Theme toggle button */
  #theme-toggle-btn {
    position: fixed;
    top: 10px;
    right: 10px;
    padding: 6px 10px;
    background: rgba(0, 0, 0, 0.6);
    color: white;
    border-radius: 5px;
    font-size: 14px;
    cursor: pointer;
    z-index: 9999;
    user-select: none;
  }

  body.mdview-dark #theme-toggle-btn {
    background: rgba(255, 255, 255, 0.6);
    color: black;
  }
</style>

<div id="theme-toggle-btn">ðŸŒ“</div>
<div class="markdown-body">
  $body$
</div>

<!-- WebSocket and UI handlers are injected by client_ws.js -->
